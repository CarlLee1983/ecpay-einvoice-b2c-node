name: Setup Discussions (use PAT secret)

on:
  workflow_dispatch:
  push:
    branches: [ main ]

permissions:
  # keep default repository contents read; we will use a PAT secret for discussion API
  contents: read
  discussions: write

jobs:
  setup-discussions:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Run create_discussions script (use PAT from secret)
        # IMPORTANT: Ensure repo secret DISCUSSIONS_TOKEN exists before running this workflow.
        env:
          GITHUB_REPOSITORY: ${{ github.repository }}
          GITHUB_TOKEN: ${{ secrets.DISCUSSIONS_TOKEN }}
        run: node .github/scripts/create_discussions.js

# NOTE:
# - This workflow expects a repository secret named DISCUSSIONS_TOKEN (a PAT with repo scope).
# - If you prefer to use the built-in GITHUB_TOKEN, ensure Settings -> Actions -> Workflow permissions is set to "Read and write"
#   and the workflow is executed by a maintainer (not a fork PR). If GITHUB_TOKEN is insufficient, create the DISCUSSIONS_TOKEN secret.